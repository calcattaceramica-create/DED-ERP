# โ ููุฒุฉ ุญุฐู ุงููุตุฑููุงุช - Delete Expense Feature

## ๐ ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง

### 1. โ ุฅุถุงูุฉ Route ููุญุฐู
**ุงูููู:** `app/accounting/expenses_routes.py`

```python
@bp.route('/expenses/<int:id>/delete', methods=['POST', 'GET'])
@login_required
@permission_required('accounting.expenses.delete')
def delete_expense(id):
    """Delete expense - ุญุฐู ุงููุตุฑูู"""
    try:
        expense = Expense.query.get_or_404(id)

        # Check if expense is posted
        if expense.status == 'posted':
            # If paid by bank, reverse the bank transaction
            if expense.payment_method == 'bank' and expense.bank_account_id:
                bank_account = BankAccount.query.get(expense.bank_account_id)
                if bank_account:
                    # Add back to bank balance
                    bank_account.current_balance += expense.amount

                    # Delete related bank transaction
                    BankTransaction.query.filter_by(
                        reference_type='expense',
                        reference_id=expense.id
                    ).delete()

        # Delete the expense
        db.session.delete(expense)
        db.session.commit()

        flash('ุชู ุญุฐู ุงููุตุฑูู ุจูุฌุงุญ', 'success')
        return redirect(url_for('accounting.expenses'))

    except Exception as e:
        db.session.rollback()
        flash(f'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงููุตุฑูู: {str(e)}', 'danger')
        return redirect(url_for('accounting.expense_details', id=id))
```

**ุงููููุฒุงุช:**
- โ ูุญุฐู ุงููุตุฑูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุฐุง ูุงู ุงููุตุฑูู ูุฏููุน ุจูููุงูุ ูุฑุฌุน ุงููุจูุบ ููุญุณุงุจ ุงูุจููู
- โ ูุญุฐู ุงููุนุงููุฉ ุงูุจูููุฉ ุงููุฑุชุจุทุฉ
- โ ูุชุญูู ูู ุงูุตูุงุญูุงุช ูุจู ุงูุญุฐู

---

### 2. โ ุฅุถุงูุฉ ุฒุฑ ุงูุญุฐู ูู ุงููุงุฌูุฉ
**ุงูููู:** `app/templates/accounting/expenses.html`

```html
<button type="button" class="btn btn-sm btn-danger"
        onclick="confirmDelete({{ expense.id }}, '{{ expense.expense_number }}')"
        title="ุญุฐู">
    <i class="fas fa-trash"></i>
</button>
```

**ุงููููุฒุงุช:**
- โ ุฒุฑ ุฃุญูุฑ ูุน ุฃููููุฉ ุณูุฉ ุงูููููุงุช
- โ ูุธูุฑ ุจุฌุงูุจ ุฒุฑ ุงูุนุฑุถ
- โ ูุทูุจ ุชุฃููุฏ ูุจู ุงูุญุฐู

---

### 3. โ ุฅุถุงูุฉ JavaScript ููุชุฃููุฏ
**ุงูููู:** `app/templates/accounting/expenses.html`

```javascript
function confirmDelete(expenseId, expenseNumber) {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุตุฑูู ' + expenseNumber + 'ุ\n\nููุงุญุธุฉ: ุฅุฐุง ูุงู ุงููุตุฑูู ูุฏููุนุงู ุจูููุงูุ ุณูุชู ุฅุฑุฌุงุน ุงููุจูุบ ููุญุณุงุจ ุงูุจููู.')) {
        window.location.href = '/accounting/expenses/' + expenseId + '/delete';
    }
}
```

**ุงููููุฒุงุช:**
- โ ุฑุณุงูุฉ ุชุฃููุฏ ุจุงูุนุฑุจูุฉ
- โ ุชูุจูู ุงููุณุชุฎุฏู ุจุฃู ุงููุจูุบ ุณูุฑุฌุน ููุจูู ุฅุฐุง ูุงู ูุฏููุน ุจูููุงู
- โ ุจุณูุท ูุณูู ุงูุงุณุชุฎุฏุงู

---

### 4. โ ุฅุถุงูุฉ ุงูุตูุงุญูุงุช
**ุงูุตูุงุญูุงุช ุงููุถุงูุฉ:**
- `accounting.expenses.delete` - ุญุฐู ุงููุตุฑููุงุช
- `accounting.expenses.create` - ุฅุถุงูุฉ ุงููุตุฑููุงุช

**ุชู ุฑุจุทูุง ุจุฏูุฑ admin ุชููุงุฆูุงู**

---

### 5. โ ุชุบููุฑ ุงูุนููุฉ ุฅูู ููุฑู
**ุงูููู:** `app/models.py`

```python
currency = db.Column(db.String(3), default='EUR')  # Changed from SAR to EUR
```

**ุงูููู:** `app/templates/accounting/expenses.html`
- ุชู ุงุณุชุจุฏุงู "ุฑูุงู" ุจู `{{ currency_symbol }}`
- ุณูุธูุฑ โฌ ุจุฏูุงู ูู ุฑูุงู

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
```bash
# ุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ููู restart_app.bat
double-click restart_app.bat

# ุทุฑููุฉ 2: ูุฏููุงู
python run.py
```

### 2. ุชุณุฌูู ุงูุฏุฎูู
- ุงุณู ุงููุณุชุฎุฏู: `admin`
- ูููุฉ ุงููุฑูุฑ: `admin123`

### 3. ุงูุฐูุงุจ ุฅูู ุตูุญุฉ ุงููุตุฑููุงุช
```
http://localhost:5000/accounting/expenses
```

### 4. ุญุฐู ูุตุฑูู
1. ุงุถุบุท ุนูู ุงูุฒุฑ ุงูุฃุญูุฑ (๐๏ธ) ุจุฌุงูุจ ุงููุตุฑูู
2. ุณูุธูุฑ ุชุฃููุฏ: "ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุตุฑููุ"
3. ุงุถุบุท OK ููุญุฐู ุฃู Cancel ููุฅูุบุงุก
4. ุฅุฐุง ูุงู ุงููุตุฑูู ูุฏููุน ุจูููุงูุ ุณูุชู ุฅุฑุฌุงุน ุงููุจูุบ ููุญุณุงุจ ุงูุจููู ุชููุงุฆูุงู

---

## โ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุญุฐู ูุตุฑูู ููุฏู
1. ุฃูุดุฆ ูุตุฑูู ููุฏู
2. ุงุญุฐูู
3. ุชุญูู ูู ุฃูู ุชู ุญุฐูู ูู ุงููุงุฆูุฉ

### ุงุฎุชุจุงุฑ 2: ุญุฐู ูุตุฑูู ุจููู
1. ุฃูุดุฆ ูุตุฑูู ุจููู (ูุซูุงู 800 ููุฑู)
2. ุชุญูู ูู ุฑุตูุฏ ุงูุจูู ูุจู ุงูุญุฐู
3. ุงุญุฐู ุงููุตุฑูู
4. ุชุญูู ูู ุฃู ุฑุตูุฏ ุงูุจูู ุฒุงุฏ ุจููุฏุงุฑ 800 ููุฑู

### ุงุฎุชุจุงุฑ 3: ุงูุตูุงุญูุงุช
1. ุณุฌู ุฏุฎูู ุจูุณุชุฎุฏู ููุณ ูุฏูู ุตูุงุญูุฉ `accounting.expenses.delete`
2. ุญุงูู ุงููุตูู ุฅูู `/accounting/expenses/1/delete`
3. ูุฌุจ ุฃู ูุธูุฑ ุฎุทุฃ "Access Denied"

---

## ๐ ููุงุญุธุงุช

- โ ุงูุญุฐู ููุงุฆู ููุง ูููู ุงูุชุฑุงุฌุน ุนูู
- โ ุฅุฐุง ูุงู ุงููุตุฑูู ูุฏููุน ุจูููุงูุ ูุชู ุฅุฑุฌุงุน ุงููุจูุบ ุชููุงุฆูุงู
- โ ูุชู ุญุฐู ุงููุนุงููุฉ ุงูุจูููุฉ ุงููุฑุชุจุทุฉ
- โ ูุชุทูุจ ุตูุงุญูุฉ `accounting.expenses.delete`
- โ ุงููุณุชุฎุฏู admin ูุฏูู ุงูุตูุงุญูุฉ ุงูุชุฑุงุถูุงู

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ ุญุฐู ุงููุตุฑููุงุช ุจูุฌุงุญ ูุน:
- โ ุฒุฑ ุญุฐู ุฃุญูุฑ ูู ูุงุฆูุฉ ุงููุตุฑููุงุช
- โ ุฑุณุงูุฉ ุชุฃููุฏ ูุจู ุงูุญุฐู
- โ ุฅุฑุฌุงุน ุงููุจูุบ ููุจูู ุฅุฐุง ูุงู ูุฏููุน ุจูููุงู
- โ ูุธุงู ุตูุงุญูุงุช ูุญูู
- โ ุชุบููุฑ ุงูุนููุฉ ุฅูู ููุฑู (โฌ)

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐**

