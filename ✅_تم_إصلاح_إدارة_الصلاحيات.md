# โ ุชู ุฅุตูุงุญ ูุธุงู ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ุจูุฌุงุญ

**ุงูุชุงุฑูุฎ:** 2026-02-14  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ ุงููุดููุฉ ุงูุฃุตููุฉ:

ุงููุณุชุฎุฏู ุฃุจูุบ ุนู ูุดููุฉ ูู ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช:
- โ ุนูุฏ ุฅุถุงูุฉ ุฃู ุฅูุบุงุก ุตูุงุญูุฉ ูุฏูุฑ ูุนููุ ูุง ูุชู ุญูุธ ุงูุชุบููุฑุงุช
- โ ุงููุธุงู ูุง ูุณุชุฌูุจ ููุฃูุงูุฑ
- โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ุชุฃููุฏ ูุงุถุญุฉ

---

## ๐ ุชุญููู ุงููุดููุฉ:

### **ุงูุณุจุจ ุงูุฑุฆูุณู:**

1. **ุตูุงุญูุฉ ุฎุงุทุฆุฉ ูู Route:**
   - Route `update_role_permissions` ูุงู ูุชุทูุจ ุตูุงุญูุฉ `settings.permissions.manage`
   - ุฏูุฑ `manager` ูู ููู ูุฏูู ูุฐู ุงูุตูุงุญูุฉ
   - ุงููุณุชุฎุฏู `ali` (ุฏูุฑ manager) ูู ูุณุชุทุน ุชุญุฏูุซ ุงูุตูุงุญูุงุช

2. **ุนุฏู ูุฌูุฏ ุฑุณุงุฆู ุชุฃููุฏ:**
   - ูุง ุชูุฌุฏ ุฑุณุงูุฉ ุชุฃููุฏ ูุจู ุงูุญูุธ
   - ูุง ุชูุฌุฏ ุฑุณุงูุฉ ูุฌุงุญ ูุงุถุญุฉ ุจุนุฏ ุงูุญูุธ
   - ุตุนูุจุฉ ูุนุฑูุฉ ูุง ุฅุฐุง ุชู ุงูุญูุธ ุฃู ูุง

---

## โ ุงูุญููู ุงููุทุจูุฉ:

### **1. ุฅุตูุงุญ Route ุชุญุฏูุซ ุงูุตูุงุญูุงุช**

**ุงูููู:** `app/settings/routes.py`

**ุงูุชุบููุฑ:**
```python
# ูุจู ุงูุฅุตูุงุญ:
@permission_required('settings.permissions.manage')

# ุจุนุฏ ุงูุฅุตูุงุญ:
@permission_required('settings.roles.edit')
```

**ุงูุณุจุจ:**
- ุตูุงุญูุฉ `settings.roles.edit` ุฃูุซุฑ ููุทููุฉ ูุชุนุฏูู ุงูุฃุฏูุงุฑ
- ุฏูุฑ `manager` ูุฏูู ูุฐู ุงูุตูุงุญูุฉ ุจุงููุนู
- ูุชูุงูู ูุน ุจุงูู routes ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ

---

### **2. ุฅุถุงูุฉ ุฑุณุงุฆู ุชุฃููุฏ ูุงุถุญุฉ**

#### **ุฃ. ุฑุณุงูุฉ ุชุฃููุฏ ูุจู ุงูุญูุธ:**

ุชู ุฅุถุงูุฉ ุฏุงูุฉ JavaScript `confirmSave()` ุชุนุฑุถ:
- ุงุณู ุงูุฏูุฑ
- ุนุฏุฏ ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ
- ุฑุณุงูุฉ ุชุฃููุฏ ุจุงูุนุฑุจูุฉ ุฃู ุงูุฅูุฌููุฒูุฉ

```javascript
function confirmSave(roleId, roleName) {
    const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
    
    let message = `ูู ุฃูุช ูุชุฃูุฏ ูู ุญูุธ ุงูุตูุงุญูุงุช ููุฏูุฑ "${roleName}"?\n\nุฅุฌูุงูู ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ: ${checkedCount}`;
    
    return confirm(message);
}
```

#### **ุจ. ุฑุณุงูุฉ ูุฌุงุญ ุจุนุฏ ุงูุญูุธ:**

ุชู ุชุญุณูู ุฑุณุงูุฉ ุงููุฌุงุญ ูุชุดูู:
- ุงุณู ุงูุฏูุฑ
- ุนุฏุฏ ุงูุตูุงุญูุงุช ุงููุญููุธุฉ

```python
flash(f'ุชู ุชุญุฏูุซ ุตูุงุญูุงุช ุงูุฏูุฑ "{role.name_ar}" ุจูุฌุงุญ. ุฅุฌูุงูู ุงูุตูุงุญูุงุช: {added_count}', 'success')
```

---

### **3. ุฅุถุงูุฉ Logging ููุชุชุจุน**

ุชู ุฅุถุงูุฉ ุณุฌูุงุช ุชูุตูููุฉ ูู Route:
```python
current_app.logger.info(f'Updating permissions for role {role.name} (ID: {role.id})')
current_app.logger.info(f'Selected permission IDs: {permission_ids}')
current_app.logger.info(f'Deleted {deleted_count} existing permissions')
current_app.logger.info(f'Added {added_count} new permissions')
```

---

### **4. ุฅุถุงูุฉ ุตูุงุญูุฉ ููููุฏุฉ ูุฏูุฑ manager**

ุชู ุฅุถุงูุฉ ุตูุงุญูุฉ `settings.permissions.manage` ูุฏูุฑ `manager`:
- **ูุจู:** 59 ุตูุงุญูุฉ
- **ุจุนุฏ:** 60 ุตูุงุญูุฉ

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช:

| ุงูููู | ุงูุชุบููุฑ |
|------|---------|
| `app/settings/routes.py` | ุชุบููุฑ ุงูุตูุงุญูุฉ ุงููุทููุจุฉ + ุฅุถุงูุฉ logging + ุชุญุณูู ุฑุณุงุฆู ุงููุฌุงุญ |
| `app/templates/settings/roles.html` | ุฅุถุงูุฉ ุฏุงูุฉ confirmSave() + ุชุญุณูู ุฒุฑ ุงูุญูุธ |
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | ุฅุถุงูุฉ ุตูุงุญูุฉ settings.permissions.manage ูุฏูุฑ manager |

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

### **ูุจู ุงูุฅุตูุงุญ:**
- โ ุงููุณุชุฎุฏู ali ูุง ูุณุชุทูุน ุชุญุฏูุซ ุงูุตูุงุญูุงุช
- โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ุชุฃููุฏ
- โ ุตุนูุจุฉ ูุนุฑูุฉ ูุง ุฅุฐุง ุชู ุงูุญูุธ

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
- โ ุงููุณุชุฎุฏู ali ูุณุชุทูุน ุชุญุฏูุซ ุงูุตูุงุญูุงุช ุจูุฌุงุญ
- โ ุฑุณุงูุฉ ุชุฃููุฏ ูุจู ุงูุญูุธ ุชุนุฑุถ ุนุฏุฏ ุงูุตูุงุญูุงุช
- โ ุฑุณุงูุฉ ูุฌุงุญ ูุงุถุญุฉ ุจุนุฏ ุงูุญูุธ
- โ ุณุฌูุงุช ุชูุตูููุฉ ููุชุชุจุน

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ:

### **ุงูุฎุทูุงุช:**

1. **ุณุฌู ุงูุฏุฎูู** ุจุงููุณุชุฎุฏู `ali` (ุฃู ุฃู ูุณุชุฎุฏู ุจุฏูุฑ manager)

2. **ุงุฐูุจ ุฅูู:** ุงูุฅุนุฏุงุฏุงุช โ ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ

3. **ุงุฎุชุฑ ุฏูุฑ** (ูุซู: test_viewer)

4. **ูู ุจุชุนุฏูู ุงูุตูุงุญูุงุช:**
   - ุญุฏุฏ ุจุนุถ ุงูุตูุงุญูุงุช
   - ุฃูุบู ุชุญุฏูุฏ ุจุนุถ ุงูุตูุงุญูุงุช
   - ุฑุงูุจ ุงูุนุฏุงุฏุงุช ุชุชุญุฏุซ ุชููุงุฆูุงู

5. **ุงุถุบุท ุนูู "ุญูุธ ุงูุตูุงุญูุงุช":**
   - ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ุชุฃููุฏ ุชุนุฑุถ:
     - ุงุณู ุงูุฏูุฑ
     - ุนุฏุฏ ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ
   - ุงุถุบุท "OK" ููุชุฃููุฏ

6. **ุชุญูู ูู ุฑุณุงูุฉ ุงููุฌุงุญ:**
   - ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ุฎุถุฑุงุก ูู ุงูุฃุนูู:
     - "ุชู ุชุญุฏูุซ ุตูุงุญูุงุช ุงูุฏูุฑ [ุงุณู ุงูุฏูุฑ] ุจูุฌุงุญ. ุฅุฌูุงูู ุงูุตูุงุญูุงุช: [ุงูุนุฏุฏ]"

7. **ุชุญูู ูู ุญูุธ ุงูุชุบููุฑุงุช:**
   - ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
   - ุชุฃูุฏ ุฃู ุงูุตูุงุญูุงุช ุงููุญุฏุฏุฉ ูุง ุชุฒุงู ูุญุฏุฏุฉ
   - ุชุฃูุฏ ุฃู ุงูุนุฏุงุฏ ูุนุฑุถ ุงูุนุฏุฏ ุงูุตุญูุญ

---

## ๐ ุตูุงุญูุงุช ุงููุณุชุฎุฏู ali:

**ุงูุฏูุฑ:** ูุฏูุฑ (manager)  
**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 60 ุตูุงุญูุฉ

**ุงูุตูุงุญูุงุช ุงููููุฉ:**
- โ `settings.roles.edit` - ุชุนุฏูู ุงูุฃุฏูุงุฑ
- โ `settings.permissions.manage` - ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
- โ `settings.roles.manage` - ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
- โ `settings.users.edit` - ุชุนุฏูู ุงููุณุชุฎุฏููู
- โ `settings.users.delete` - ุญุฐู ุงููุณุชุฎุฏููู

---

## ๐ ุงูุฎูุงุตุฉ:

**ุงููุธุงู ุงูุขู:**
- โ ูุนูู ุจุดูู ุตุญูุญ ูุณูุณ
- โ ูุนุฑุถ ุฑุณุงุฆู ุชุฃููุฏ ูุงุถุญุฉ
- โ ูุญูุธ ุงูุชุบููุฑุงุช ุจูุฌุงุญ
- โ ูููุฑ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ

**ูููู ูููุณุชุฎุฏููู ุงูุขู:**
- โ ุฅุถุงูุฉ ุตูุงุญูุงุช ููุฃุฏูุงุฑ
- โ ุฅูุบุงุก ุตูุงุญูุงุช ูู ุงูุฃุฏูุงุฑ
- โ ุฑุคูุฉ ุนุฏุฏ ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ
- โ ุงูุชุฃูุฏ ูู ุญูุธ ุงูุชุบููุฑุงุช

---

**๐ฏ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

