{% extends "base.html" %}

{% block title %}{{ _('Permissions Management') }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-key"></i> {{ _('Permissions Management') }}</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPermissionModal">
            <i class="fas fa-plus"></i> {{ _('Add New Permission') }}
        </button>
    </div>

    <div class="card">
        <div class="card-body">
            {% set modules = {} %}
            {% for permission in permissions %}
                {% if permission.module not in modules %}
                    {% set _ = modules.update({permission.module: []}) %}
                {% endif %}
                {% set _ = modules[permission.module].append(permission) %}
            {% endfor %}

            {% for module, perms in modules.items() %}
            <div class="mb-4">
                <h4 class="text-primary border-bottom pb-2">
                    <i class="fas fa-folder"></i> {{ module|title }}
                </h4>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>{{ _('Permission Name') }}</th>
                                <th>{{ _('Arabic Name') }}</th>
                                <th>{{ _('Module') }}</th>
                                <th>{{ _('Number of Roles') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for perm in perms %}
                            <tr>
                                <td>{{ perm.id }}</td>
                                <td><code>{{ perm.name }}</code></td>
                                <td>{{ perm.name_ar }}</td>
                                <td><span class="badge bg-info">{{ perm.module }}</span></td>
                                <td>{{ perm.roles|length }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add Permission Modal -->
<div class="modal fade" id="addPermissionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('settings.add_permission') }}">
                <div class="modal-header">
                    <h5 class="modal-title">{{ _('Add New Permission') }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">{{ _('Permission Name (English)') }} *</label>
                        <input type="text" class="form-control" name="name" required>
                        <small class="text-muted">{{ _('Example: inventory.create') }}</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _('Permission Name (Arabic)') }} *</label>
                        <input type="text" class="form-control" name="name_ar" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _('Module') }} *</label>
                        <select class="form-select" name="module" required>
                            <option value="">{{ _('Choose Module') }}</option>
                            <option value="main">{{ _('Main') }}</option>
                            <option value="inventory">{{ _('Inventory') }}</option>
                            <option value="sales">{{ _('Sales') }}</option>
                            <option value="purchases">{{ _('Purchases') }}</option>
                            <option value="accounting">{{ _('Accounting') }}</option>
                            <option value="hr">{{ _('Human Resources') }}</option>
                            <option value="pos">{{ _('Point of Sale') }}</option>
                            <option value="reports">{{ _('Reports') }}</option>
                            <option value="settings">{{ _('Settings') }}</option>
                            <option value="crm">{{ _('CRM') }}</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ _('Cancel') }}</button>
                    <button type="submit" class="btn btn-primary">{{ _('Save') }}</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

