# ๐ข ุญุงูุฉ ูุธุงู ุงูุดุฑูุงุช (Multi-Tenant System)

## ๐ ุฅุฌุงุจุงุช ุนูู ุฃุณุฆูุชู:

---

### โ **1. ูู ููุงู ูุธุงู ุงูุดุฑูุงุชุ**

**ูุนู! โ** ุงููุธุงู ูุญุชูู ุนูู ูุธุงู ุดุฑูุงุช ูุชุนุฏุฏ (Multi-Tenant System) ูุชูุงูู.

**ุงูุฏููู:**
- โ ุฌุฏูู `tenants` ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูููุฐุฌ `Tenant` ููุฌูุฏ ูู `app/models_tenant.py`
- โ ูุธุงู `TenantMixin` ููุฌูุฏ ูู `app/tenant_mixin.py`
- โ ูุธุงู `TenantMiddleware` ููุฌูุฏ ูู `app/tenant_middleware.py`

**ุงูุดุฑูุฉ ุงูุญุงููุฉ:**
```
ID: 1
Code: DEFAULT
Name: CALCATTA BATHROOMS AND TILES
Subdomain: default
Active: True
```

---

### โ **2. ูู ุงููุณุชุฎุฏู ูุฑุจูุท ุจุงูุดุฑูุฉุ**

**ูุนู! โ** ุฌููุน ุงููุณุชุฎุฏููู ูุฑุจูุทูู ุจุงูุดุฑูุฉ.

**ุงูุฏููู:**
- โ ุฌุฏูู `users` ูุญุชูู ุนูู ุนููุฏ `tenant_id`
- โ ุฌููุน ุงููุณุชุฎุฏููู ุงูุญุงูููู (3 ูุณุชุฎุฏููู) ูุฑุจูุทูู ุจุงูุดุฑูุฉ ุฑูู 1:

```
User 1: admin@example.com โ tenant_id: 1
User 2: ali@a1 โ tenant_id: 1
User 3: abdo@ff.com โ tenant_id: 1
```

**ุงูุนูุงูุฉ ูู ุงููููุฐุฌ:**
```python
class User(UserMixin, db.Model):
    tenant_id = db.Column(db.Integer, db.ForeignKey('tenants.id'), nullable=True)
    
    # Unique constraint: username + tenant_id
    __table_args__ = (
        db.UniqueConstraint('username', 'tenant_id', name='uq_user_username_tenant'),
        db.UniqueConstraint('email', 'tenant_id', name='uq_user_email_tenant'),
    )
```

---

### โ **3. ูู ุงูุจูุงูุงุช ูุฑุจูุทุฉ ุจุงูุดุฑูุงุชุ**

**ูุนู! โ** ุฌููุน ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ ูุฑุจูุทุฉ ุจุงูุดุฑูุงุช.

**ุงูุฌุฏุงูู ุงููุฑุจูุทุฉ ุจู `tenant_id`:**

| ุงููุญุฏุฉ | ุงูุฌุฏุงูู |
|--------|---------|
| **ุงููุจูุนุงุช** | sales_invoices, sales_invoice_items, quotations, sales_orders |
| **ุงููุดุชุฑูุงุช** | purchase_invoices, purchase_invoice_items, purchase_orders, purchase_returns |
| **ุงููุญุงุณุจุฉ** | accounts, journal_entries, payments, bank_accounts, expenses |
| **ุงููุฎุฒูู** | products, stock, stock_movements, damaged_inventory, warehouses |
| **POS** | pos_sessions, pos_orders, pos_order_items |
| **ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ** | employees, departments, attendance, leaves, payrolls |
| **CRM** | leads, opportunities, contacts, campaigns |
| **ุงูุฅุนุฏุงุฏุงุช** | branches, cost_centers, customers, suppliers |

**ุฅุฌูุงูู ุงูุฌุฏุงูู ุงููุญุฏุซุฉ:** 46+ ุฌุฏูู

---

### โ **4. ูู ูุชู ุฅูุดุงุก ุดุฑูุฉ ุชููุงุฆูุงู ุนูุฏ ุงูุชุณุฌููุ**

**ูุง! โ** ุญุงููุงู ูุง ููุฌุฏ ูุธุงู ุชุณุฌูู ุชููุงุฆู ููุดุฑูุงุช.

**ุงููุถุน ุงูุญุงูู:**
- โ ูุง ุชูุฌุฏ ุตูุญุฉ ุชุณุฌูู (Register) ูู `app/auth/routes.py`
- โ ูุง ููุฌุฏ endpoint ูุฅูุดุงุก ุดุฑูุฉ ุฌุฏูุฏุฉ
- โ ููุฌุฏ ููุท ุตูุญุฉ ุชุณุฌูู ุฏุฎูู (Login)

**ุงูุดุฑูุฉ ุงูุญุงููุฉ:**
- ุชู ุฅูุดุงุก ุดุฑูุฉ ูุงุญุฏุฉ ุงูุชุฑุงุถูุฉ (DEFAULT) ุนูุฏ ุงูุชุฑุญูู (Migration)
- ุฌููุน ุงููุณุชุฎุฏููู ููุชููู ููุฐู ุงูุดุฑูุฉ

---

## ๐ง **ููู ูุนูู ุงููุธุงู ุญุงููุงู:**

### 1. **ุชุญุฏูุฏ ุงูุดุฑูุฉ ุงูุญุงููุฉ:**
ุงููุธุงู ูุญุฏุฏ ุงูุดุฑูุฉ ูู:
- **Subdomain** (ูุซู: company1.localhost)
- **Session** (ูู ุงููุณุชุฎุฏู ุงููุณุฌู)
- **HTTP Header** (ููู API)

### 2. **ููุชุฑุฉ ุงูุจูุงูุงุช:**
- ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชูููุชุฑ ุชููุงุฆูุงู ุญุณุจ `tenant_id`
- ูู ุดุฑูุฉ ุชุฑู ุจูุงูุงุชูุง ููุท

### 3. **ุนุฒู ุงูุจูุงูุงุช:**
- ูู ุดุฑูุฉ ููุง ุจูุงูุงุช ูููุตูุฉ ุชูุงูุงู
- ูุง ูููู ูุดุฑูุฉ ุงููุตูู ูุจูุงูุงุช ุดุฑูุฉ ุฃุฎุฑู

---

## ๐ **ุงูุฅุญุตุงุฆูุงุช ุงูุญุงููุฉ:**

```
โ ุนุฏุฏ ุงูุดุฑูุงุช: 1
โ ุนุฏุฏ ุงููุณุชุฎุฏููู: 3
โ ุฌููุน ุงููุณุชุฎุฏููู ูุฑุจูุทูู ุจุงูุดุฑูุฉ ุฑูู 1
โ ุฌููุน ุงูุจูุงูุงุช ูุฑุจูุทุฉ ุจุงูุดุฑูุฉ ุฑูู 1
```

---

## ๐ก **ูุง ุงูุฐู ูููู ุฅุถุงูุชู:**

### 1. **ุตูุญุฉ ุชุณุฌูู ุดุฑูุฉ ุฌุฏูุฏุฉ:**
```python
@bp.route('/register-company', methods=['GET', 'POST'])
def register_company():
    # ุฅูุดุงุก ุดุฑูุฉ ุฌุฏูุฏุฉ
    # ุฅูุดุงุก ูุณุชุฎุฏู admin ููุดุฑูุฉ
    # ุชุณุฌูู ุฏุฎูู ุชููุงุฆู
```

### 2. **ุตูุญุฉ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ:**
```python
@bp.route('/select-company')
def select_company():
    # ุนุฑุถ ูุงุฆูุฉ ุงูุดุฑูุงุช ุงููุชุงุญุฉ
    # ุงูุณูุงุญ ูููุณุชุฎุฏู ุจุงุฎุชูุงุฑ ุดุฑูุฉ
```

### 3. **ุฅูุดุงุก ุดุฑูุฉ ุชููุงุฆูุงู ุนูุฏ ุงูุชุณุฌูู:**
```python
@bp.route('/register', methods=['GET', 'POST'])
def register():
    # ุฅูุดุงุก ุดุฑูุฉ ุฌุฏูุฏุฉ
    # ุฅูุดุงุก ูุณุชุฎุฏู admin
    # ุฑุจุท ุงููุณุชุฎุฏู ุจุงูุดุฑูุฉ
```

---

## ๐ฏ **ุงูุฎูุงุตุฉ:**

| ุงูุณุคุงู | ุงูุฅุฌุงุจุฉ | ุงูุญุงูุฉ |
|---------|---------|--------|
| ูู ููุงู ูุธุงู ุงูุดุฑูุงุชุ | **ูุนู** | โ ููุฌูุฏ ูููุนูู |
| ูู ุงููุณุชุฎุฏู ูุฑุจูุท ุจุงูุดุฑูุฉุ | **ูุนู** | โ ุฌููุน ุงููุณุชุฎุฏููู ูุฑุจูุทูู |
| ูู ุงูุจูุงูุงุช ูุฑุจูุทุฉ ุจุงูุดุฑูุงุชุ | **ูุนู** | โ 46+ ุฌุฏูู ูุฑุจูุท |
| ูู ูุชู ุฅูุดุงุก ุดุฑูุฉ ุชููุงุฆูุงูุ | **ูุง** | โ ุบูุฑ ููุนูู |

---

## ๐ **ููุงุญุธุงุช:**

1. **ุงููุธุงู ุฌุงูุฒ ููุนูู ูุชุนุฏุฏ ุงูุดุฑูุงุช** ูููู ูุญุชุงุฌ:
   - ุตูุญุฉ ุชุณุฌูู ุดุฑูุงุช ุฌุฏูุฏุฉ
   - ุตูุญุฉ ุงุฎุชูุงุฑ ุงูุดุฑูุฉ
   - ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุดุฑูุงุช

2. **ุญุงููุงู:** ุงููุธุงู ูุนูู ุจุดุฑูุฉ ูุงุญุฏุฉ ุงูุชุฑุงุถูุฉ (DEFAULT)

3. **ููุชูุณุน:** ูููู ุจุณูููุฉ ุฅุถุงูุฉ ุดุฑูุงุช ุฌุฏูุฏุฉ ููุณุชุฎุฏููู ููู ุดุฑูุฉ

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ:** 2026-02-18

