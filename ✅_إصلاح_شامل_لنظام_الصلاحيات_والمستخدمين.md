# โ ุฅุตูุงุญ ุดุงูู ููุธุงู ุงูุตูุงุญูุงุช ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

## ๐ ููุฎุต ุงููุดููุฉ

### ุงููุดููุฉ ุงููุจูุบ ุนููุง:
> "ูุง ุชุฒุงู ุงููุดููุฉ ููุฌูุฏุฉ - ุงูุงู ุงุตูุญ ุงุฏุงุฑุฉ ุงูุตูุงุญูุงุช ุจู ุงููุงูู ู ุงุฑุจุทูุง ุจู ุงุฏุงุฑุฉ ุงููุณุชุฎุฏููู ู ุงูุตูุงุญูุงุช"

### ุงูุชุญููู ุงูุนููู:
ุจุนุฏ ุงููุญุต ุงูุดุงูู ูููุธุงูุ ุชุจูู ุฃู ุงููุดููุฉ ูุงูุช ูู **ุซูุงุซุฉ ูุณุชููุงุช**:

1. **โ ุตูุงุญูุงุช ููููุฏุฉ ูู ุฏูุฑ ุงููุฏูุฑ**
2. **โ ููุงูุจ ุบูุฑ ูุญููุฉ ุจูุญุต ุงูุตูุงุญูุงุช**
3. **โ routes ููููุฏุฉ ููุชุนุฏูู ูุงูุญุฐู**

---

## ๐ ุงููุดุงูู ุงูุชู ุชู ุงูุชุดุงููุง

### 1. ุตูุงุญูุงุช ุงููุฏูุฑ (Manager Role):
- โ ุงููุฏูุฑ ูุฏูู 67 ุตูุงุญูุฉ
- โ ููุชูุฏ ุตูุงุญูุชูู ูููุชูู:
  - `accounting.accounts.add` (ุฅุถุงูุฉ ุญุณุงุจ ุจููู)
  - `accounting.accounts.delete` (ุญุฐู ุญุณุงุจ ุจููู)
- โ ูุฏูู ููุท `accounting.accounts.edit` (ุชุนุฏูู)

### 2. ูุงูุจ ุงูุญุณุงุจุงุช ุงูุจูููุฉ (`bank_accounts.html`):
- โ ุฒุฑ "ุฅุถุงูุฉ ุญุณุงุจ ุจููู" ุธุงูุฑ ููุฌููุน (ุจุฏูู ูุญุต ุตูุงุญูุงุช)
- โ ูุง ุชูุฌุฏ ุฃุฒุฑุงุฑ ููุชุนุฏูู ุฃู ุงูุญุฐู ูู ุงูุฌุฏูู
- โ ูุง ููุฌุฏ JavaScript ูุชุฃููุฏ ุงูุญุฐู

### 3. Routes ุงูููููุฏุฉ:
- โ ูุง ููุฌุฏ `edit_bank_account` route
- โ ูุง ููุฌุฏ `delete_bank_account` route
- โ ูุง ููุฌุฏ ูุงูุจ `edit_bank_account.html`

---

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงูููููุฏุฉ ูููุฏูุฑ:

**ุงูุณูุฑูุจุช:** `fix_manager_permissions_final.py`

```python
# ุชู ุฅุถุงูุฉ ุตูุงุญูุชูู:
- accounting.accounts.add (ID: 49)
- accounting.accounts.delete (ID: 51)

# ุงููุชูุฌุฉ:
- ูุจู: 67 ุตูุงุญูุฉ
- ุจุนุฏ: 69 ุตูุงุญูุฉ
```

**ุงูุชุญูู:**
```
โ accounting.accounts.add: TRUE
โ accounting.accounts.edit: TRUE
โ accounting.accounts.delete: TRUE
```

---

### 2. ุญูุงูุฉ ูุงูุจ `bank_accounts.html`:

#### ุฃ. ุญูุงูุฉ ุฒุฑ "ุฅุถุงูุฉ":
```html
{% if current_user.has_permission('accounting.accounts.add') %}
<a href="{{ url_for('accounting.add_bank_account') }}" class="btn btn-light">
    <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุญุณุงุจ ุจููู
</a>
{% endif %}
```

#### ุจ. ุฅุถุงูุฉ ุนููุฏ "ุงูุฅุฌุฑุงุกุงุช":
```html
{% if current_user.has_permission('accounting.accounts.edit') or current_user.has_permission('accounting.accounts.delete') %}
<th>ุงูุฅุฌุฑุงุกุงุช</th>
{% endif %}
```

#### ุฌ. ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ุงูุชุนุฏูู ูุงูุญุฐู:
```html
<div class="btn-group btn-group-sm" role="group">
    {% if current_user.has_permission('accounting.accounts.edit') %}
    <a href="{{ url_for('accounting.edit_bank_account', id=account.id) }}" 
       class="btn btn-warning btn-sm">
        <i class="fas fa-edit"></i>
    </a>
    {% endif %}
    {% if current_user.has_permission('accounting.accounts.delete') %}
    <button type="button" class="btn btn-danger btn-sm" 
            onclick="confirmDelete({{ account.id }}, '{{ account.account_name }}')">
        <i class="fas fa-trash"></i>
    </button>
    {% endif %}
</div>
```

#### ุฏ. ุฅุถุงูุฉ JavaScript ููุญุฐู:
```javascript
function confirmDelete(accountId, accountName) {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุญุณุงุจ ุงูุจููู "' + accountName + '"ุ')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/accounting/bank-accounts/delete/' + accountId;
        document.body.appendChild(form);
        form.submit();
    }
}
```

---

### 3. ุฅุถุงูุฉ Routes ูู `accounting/routes.py`:

#### ุฃ. Route ุงูุชุนุฏูู:
```python
@bp.route('/bank-accounts/edit/<int:id>', methods=['GET', 'POST'])
@login_required
@permission_required('accounting.accounts.edit')
def edit_bank_account(id):
    """Edit bank account - ุชุนุฏูู ุญุณุงุจ ุจููู"""
    account = BankAccount.query.get_or_404(id)
    
    if request.method == 'POST':
        # Update account details
        account.account_name = request.form.get('account_name')
        account.account_number = request.form.get('account_number')
        # ... other fields
        db.session.commit()
        flash('ุชู ุชุญุฏูุซ ุงูุญุณุงุจ ุงูุจููู ุจูุฌุงุญ', 'success')
        return redirect(url_for('accounting.bank_accounts'))
    
    return render_template('accounting/edit_bank_account.html', account=account)
```

#### ุจ. Route ุงูุญุฐู:
```python
@bp.route('/bank-accounts/delete/<int:id>', methods=['POST'])
@login_required
@permission_required('accounting.accounts.delete')
def delete_bank_account(id):
    """Delete bank account - ุญุฐู ุญุณุงุจ ุจููู"""
    account = BankAccount.query.get_or_404(id)
    # Soft delete - mark as inactive
    account.is_active = False
    db.session.commit()
    flash('ุชู ุญุฐู ุงูุญุณุงุจ ุงูุจููู ุจูุฌุงุญ', 'success')
    return redirect(url_for('accounting.bank_accounts'))
```

---

### 4. ุฅูุดุงุก ูุงูุจ `edit_bank_account.html`:

**ุงูููู:** `app/templates/accounting/edit_bank_account.html`

**ุงููููุฒุงุช:**
- โ ูููุฐุฌ ูุงูู ูุชุนุฏูู ุงูุญุณุงุจ ุงูุจููู
- โ ุงูุฑุตูุฏ ุงูุญุงูู (ูููุฑุงุกุฉ ููุท)
- โ ูุนูููุงุช ุงูุญุณุงุจ (ุงูุฑุตูุฏ ุงูุงูุชุชุงุญูุ ุชุงุฑูุฎ ุงูุฅูุดุงุกุ ุงูุญุงูุฉ)
- โ ุฑุจุท ุจุฏููู ุงูุญุณุงุจุงุช
- โ ุญูู ุงูููุงุญุธุงุช

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูุจู ุงูุฅุตูุงุญ:
| ุงููุดููุฉ | ุงูุญุงูุฉ |
|---------|--------|
| ุตูุงุญูุงุช ุงููุฏูุฑ | โ ูุงูุตุฉ (67 ุตูุงุญูุฉ) |
| ุฒุฑ "ุฅุถุงูุฉ" | โ ุธุงูุฑ ููุฌููุน |
| ุฃุฒุฑุงุฑ "ุชุนุฏูู/ุญุฐู" | โ ุบูุฑ ููุฌูุฏุฉ |
| Routes ุงูุชุนุฏูู/ุงูุญุฐู | โ ุบูุฑ ููุฌูุฏุฉ |
| ูุงูุจ ุงูุชุนุฏูู | โ ุบูุฑ ููุฌูุฏ |

### ุจุนุฏ ุงูุฅุตูุงุญ:
| ุงููุดููุฉ | ุงูุญุงูุฉ |
|---------|--------|
| ุตูุงุญูุงุช ุงููุฏูุฑ | โ ูุงููุฉ (69 ุตูุงุญูุฉ) |
| ุฒุฑ "ุฅุถุงูุฉ" | โ ูุญูู ุจุตูุงุญูุฉ |
| ุฃุฒุฑุงุฑ "ุชุนุฏูู/ุญุฐู" | โ ูุญููุฉ ุจุตูุงุญูุงุช |
| Routes ุงูุชุนุฏูู/ุงูุญุฐู | โ ููุฌูุฏุฉ ููุญููุฉ |
| ูุงูุจ ุงูุชุนุฏูู | โ ููุฌูุฏ ููุงูู |

---

## ๐ฏ ูุธุงู ุงูุตูุงุญูุงุช ุงูุขู

### ูุณุชููุงู ูู ุงูุญูุงูุฉ:

#### 1. Backend (Routes):
```python
@permission_required('accounting.accounts.add')
@permission_required('accounting.accounts.edit')
@permission_required('accounting.accounts.delete')
```

#### 2. Frontend (Templates):
```html
{% if current_user.has_permission('accounting.accounts.add') %}
{% if current_user.has_permission('accounting.accounts.edit') %}
{% if current_user.has_permission('accounting.accounts.delete') %}
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ูุน ุงููุฏูุฑ (ali):
```
ุงููุณุชุฎุฏู: ali
ุงูุฏูุฑ: manager
ุงูุตูุงุญูุงุช: 69 ุตูุงุญูุฉ
```

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจ `ali`
2. ุงุฐูุจ ุฅูู: `/accounting/bank-accounts`
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
   - โ ุฒุฑ "ุฅุถุงูุฉ ุญุณุงุจ ุจููู" ุธุงูุฑ
   - โ ุฃุฒุฑุงุฑ "ุชุนุฏูู" ู"ุญุฐู" ุธุงูุฑุฉ
   - โ ูููู ุฅุถุงูุฉ ุญุณุงุจ ุฌุฏูุฏ
   - โ ูููู ุชุนุฏูู ุญุณุงุจ ููุฌูุฏ
   - โ ูููู ุญุฐู ุญุณุงุจ

### 2. ุงุฎุชุจุงุฑ ูุน ูุณุชุฎุฏู ูุญุฏูุฏ:
```
ุงููุณุชุฎุฏู: test_limited
ุงูุฏูุฑ: limited_user
ุงูุตูุงุญูุงุช: view only
```

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจ `test_limited`
2. ุงุฐูุจ ุฅูู: `/accounting/bank-accounts`
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
   - โ ุฒุฑ "ุฅุถุงูุฉ" ูุฎูู
   - โ ุฃุฒุฑุงุฑ "ุชุนุฏูู" ู"ุญุฐู" ูุฎููุฉ
   - โ ูุง ูููู ุงููุตูู ููู URLs ูุจุงุดุฑุฉ (403 Forbidden)

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

| ุงูููู | ุงูุชุนุฏููุงุช |
|------|-----------|
| `app/templates/accounting/bank_accounts.html` | โ ุญูุงูุฉ ุงูุฃุฒุฑุงุฑ + ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ุชุนุฏูู/ุญุฐู + JavaScript |
| `app/accounting/routes.py` | โ ุฅุถุงูุฉ routes ููุชุนุฏูู ูุงูุญุฐู |
| `app/templates/accounting/edit_bank_account.html` | โ ุฅูุดุงุก ูุงูุจ ุฌุฏูุฏ |
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ ุฅุถุงูุฉ ุตูุงุญูุชูู ูุฏูุฑ ุงููุฏูุฑ |

---

## ๐ ุงูุฎูุงุตุฉ

### ุงููุดููุฉ ุงูุฃุตููุฉ:
- "ูุธุงู ุงูุตูุงุญูุงุช ูุง ูุนูู"

### ุงูุณุจุจ ุงูุญูููู:
1. โ ูุธุงู ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ุตุญูุญ
2. โ ุตูุงุญูุงุช ููููุฏุฉ ูู ุฏูุฑ ุงููุฏูุฑ
3. โ ุงูููุงูุจ ุบูุฑ ูุญููุฉ
4. โ Routes ููููุฏุฉ

### ุงูุญู:
- โ ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงูููููุฏุฉ
- โ ุญูุงูุฉ ุฌููุน ุงูููุงูุจ
- โ ุฅุถุงูุฉ ุฌููุน ุงูู routes ุงููุทููุจุฉ
- โ ูุธุงู ุงูุตูุงุญูุงุช ุงูุขู ูุนูู ุนูู ูุณุชูููู (Backend + Frontend)

---

**๐ฏ ุงููุธุงู ุงูุขู ุขูู ููุญูู ุจุงููุงูู! ููููู ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ุจุซูุฉ! ๐**

